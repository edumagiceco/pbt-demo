<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ë©˜í†  í¸ì§‘ - AI ì¸ì¬ ì»¤ë¦¬ì–´ í”Œë«í¼ PBT</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            line-height: 1.6;
        }
        
        .navbar {
            background: rgba(255, 255, 255, 0.95);
            padding: 1rem 2rem;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
            backdrop-filter: blur(10px);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .navbar .logo {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            font-size: 1.2rem;
            font-weight: 700;
            color: #4a5568;
        }
        
        .navbar .logo img {
            height: 40px;
            width: auto;
        }
        
        .navbar .nav-links {
            display: flex;
            gap: 1rem;
            align-items: center;
        }
        
        .navbar .nav-links a {
            color: #4a5568;
            text-decoration: none;
            padding: 0.5rem 1rem;
            border-radius: 8px;
            transition: all 0.3s ease;
        }
        
        .navbar .nav-links a:hover {
            background: rgba(102, 126, 234, 0.1);
        }
        
        .container {
            max-width: 800px;
            margin: 2rem auto;
            padding: 0 2rem;
        }
        
        .page-header {
            background: rgba(255, 255, 255, 0.95);
            padding: 2rem;
            border-radius: 15px;
            margin-bottom: 2rem;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.15);
            text-align: center;
        }
        
        .page-header h1 {
            color: #4a5568;
            font-size: 2.5rem;
            margin-bottom: 1rem;
        }
        
        .page-header p {
            color: #718096;
            font-size: 1.1rem;
        }
        
        .loading-state {
            text-align: center;
            padding: 3rem;
            color: #718096;
        }
        
        .loading-spinner {
            display: inline-block;
            width: 40px;
            height: 40px;
            border: 4px solid #e2e8f0;
            border-left: 4px solid #667eea;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-bottom: 1rem;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .form-container {
            background: rgba(255, 255, 255, 0.95);
            padding: 2rem;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.15);
            display: none;
        }
        
        .form-container.loaded {
            display: block;
        }
        
        .form-group {
            margin-bottom: 1.5rem;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 0.5rem;
            color: #4a5568;
            font-weight: 600;
        }
        
        .form-group input,
        .form-group textarea,
        .form-group select {
            width: 100%;
            padding: 0.75rem;
            border: 2px solid #e2e8f0;
            border-radius: 8px;
            font-size: 1rem;
            transition: all 0.3s ease;
        }
        
        .form-group input:focus,
        .form-group textarea:focus,
        .form-group select:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }
        
        .form-group textarea {
            resize: vertical;
            min-height: 100px;
        }
        
        .checkbox-group {
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        
        .checkbox-group input[type="checkbox"] {
            width: auto;
        }
        
        .knowledge-section {
            border: 2px dashed #e2e8f0;
            padding: 2rem;
            border-radius: 10px;
            margin: 1.5rem 0;
            text-align: center;
        }
        
        .knowledge-type-tabs {
            display: flex;
            gap: 0.5rem;
            margin-bottom: 1.5rem;
            border-radius: 8px;
            background: #f7fafc;
            padding: 0.3rem;
        }
        
        .knowledge-tab {
            flex: 1;
            padding: 0.75rem;
            background: transparent;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-weight: 500;
            transition: all 0.3s ease;
        }
        
        .knowledge-tab.active {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }
        
        .knowledge-content {
            display: none;
        }
        
        .knowledge-content.active {
            display: block;
        }
        
        .file-upload-area {
            border: 2px dashed #cbd5e0;
            border-radius: 10px;
            padding: 2rem;
            text-align: center;
            transition: all 0.3s ease;
            cursor: pointer;
        }
        
        .file-upload-area:hover {
            border-color: #667eea;
            background: rgba(102, 126, 234, 0.05);
        }
        
        .file-upload-area.dragover {
            border-color: #667eea;
            background: rgba(102, 126, 234, 0.1);
        }
        
        .btn {
            padding: 0.75rem 2rem;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            text-decoration: none;
            display: inline-block;
            transition: all 0.3s ease;
            font-size: 1rem;
        }
        
        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }
        
        .btn-secondary {
            background: #f7fafc;
            color: #4a5568;
            border: 2px solid #e2e8f0;
        }
        
        .btn-danger {
            background: linear-gradient(135deg, #e53e3e 0%, #c53030 100%);
            color: white;
        }
        
        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
        }
        
        .btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }
        
        .form-actions {
            display: flex;
            gap: 1rem;
            justify-content: space-between;
            margin-top: 2rem;
            padding-top: 2rem;
            border-top: 1px solid #e2e8f0;
        }
        
        .form-actions .left {
            display: flex;
            gap: 1rem;
        }
        
        .form-actions .right {
            display: flex;
            gap: 1rem;
        }
        
        .avatar-preview {
            width: 100px;
            height: 100px;
            border-radius: 50%;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2rem;
            color: white;
            margin: 0 auto 1rem auto;
            font-weight: bold;
        }
        
        .knowledge-item {
            background: #f7fafc;
            padding: 1rem;
            border-radius: 8px;
            margin-bottom: 1rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .knowledge-item .info {
            flex-grow: 1;
        }
        
        .knowledge-item .remove-btn {
            background: #fed7e2;
            color: #9b2c2c;
            border: none;
            border-radius: 4px;
            padding: 0.25rem 0.5rem;
            cursor: pointer;
            font-size: 0.8rem;
        }
        
        .progress-bar {
            width: 100%;
            height: 8px;
            background: #e2e8f0;
            border-radius: 4px;
            overflow: hidden;
            margin-top: 0.5rem;
        }
        
        .progress-fill {
            height: 100%;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            transition: width 0.3s ease;
        }
        
        .error-message {
            background: rgba(254, 215, 226, 0.8);
            color: #9b2c2c;
            padding: 1rem;
            border-radius: 8px;
            margin-top: 1rem;
            text-align: center;
        }
        
        @media (max-width: 768px) {
            .navbar {
                padding: 1rem;
                flex-direction: column;
                gap: 1rem;
            }
            
            .container {
                padding: 0 1rem;
            }
            
            .form-actions {
                flex-direction: column;
            }
            
            .form-actions .left,
            .form-actions .right {
                width: 100%;
                justify-content: center;
            }
            
            .knowledge-type-tabs {
                flex-direction: column;
            }
        }
    </style>
</head>
<body>
    <nav class="navbar">
        <div class="logo">
            <img src="/assets/images/pbt-logo.png" alt="PBT Logo">
            <span>AI ì¸ì¬ ì»¤ë¦¬ì–´ í”Œë«í¼ PBT</span>
        </div>
        <div class="nav-links">
            <a href="/dashboard.html">ëŒ€ì‹œë³´ë“œ</a>
            <a href="/mentors.html">AI ë©˜í† </a>
            <a href="/profile.html">í”„ë¡œí•„</a>
        </div>
    </nav>
    
    <div class="container">
        <div class="page-header">
            <h1>âœï¸ AI ë©˜í†  í¸ì§‘</h1>
            <p>ë©˜í† ì˜ ì •ë³´ì™€ ì§€ì‹ì„ ìˆ˜ì •í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤</p>
        </div>
        
        <!-- ë¡œë”© ìƒíƒœ -->
        <div id="loadingState" class="loading-state">
            <div class="loading-spinner"></div>
            <p>ë©˜í†  ì •ë³´ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</p>
        </div>
        
        <!-- ì˜¤ë¥˜ ìƒíƒœ -->
        <div id="errorState" class="error-message" style="display: none;">
            <p>ë©˜í†  ì •ë³´ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ”ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.</p>
            <button class="btn btn-secondary" onclick="window.location.href='/mentors.html'">ëª©ë¡ìœ¼ë¡œ ëŒì•„ê°€ê¸°</button>
        </div>
        
        <div class="form-container" id="formContainer">
            <form id="mentorForm">
                <!-- ê¸°ë³¸ ì •ë³´ ì„¹ì…˜ -->
                <div class="form-group">
                    <label for="mentorName">ë©˜í†  ì´ë¦„ *</label>
                    <input type="text" id="mentorName" name="name" required 
                           placeholder="ì˜ˆ: ê°œë°œ ë©˜í†  Alex" maxlength="100">
                </div>
                
                <div class="form-group">
                    <label for="expertise">ì „ë¬¸ ë¶„ì•¼</label>
                    <input type="text" id="expertise" name="expertise" 
                           placeholder="ì˜ˆ: í”„ë¡œê·¸ë˜ë°, ë°ì´í„° ë¶„ì„, ë””ìì¸" maxlength="200">
                </div>
                
                <div class="form-group">
                    <label for="description">ë©˜í†  ì„¤ëª…</label>
                    <textarea id="description" name="description" 
                              placeholder="ì´ ë©˜í† ì˜ íŠ¹ì§•ê³¼ ì–´ë–¤ ë„ì›€ì„ ì¤„ ìˆ˜ ìˆëŠ”ì§€ ì„¤ëª…í•´ì£¼ì„¸ìš”..." 
                              maxlength="500"></textarea>
                </div>
                
                <!-- ì•„ë°”íƒ€ ë¯¸ë¦¬ë³´ê¸° -->
                <div class="form-group">
                    <label>ë©˜í†  ì•„ë°”íƒ€</label>
                    <div class="avatar-preview" id="avatarPreview">ğŸ¤–</div>
                </div>
                
                <!-- ì„±ê²© ì„¤ì • -->
                <div class="form-group">
                    <label for="personality">ë©˜í†  ì„±ê²©</label>
                    <select id="personality" name="personality">
                        <option value="friendly">ì¹œê·¼í•˜ê³  ë”°ëœ»í•œ</option>
                        <option value="professional">ì „ë¬¸ì ì´ê³  ì²´ê³„ì ì¸</option>
                        <option value="casual">í¸ì•ˆí•˜ê³  ììœ ë¡œìš´</option>
                        <option value="encouraging">ê²©ë ¤í•˜ê³  ë™ê¸°ë¶€ì—¬í•˜ëŠ”</option>
                        <option value="analytical">ë¶„ì„ì ì´ê³  ë…¼ë¦¬ì ì¸</option>
                    </select>
                </div>
                
                <!-- ê³µê°œ ì„¤ì • -->
                <div class="form-group">
                    <div class="checkbox-group">
                        <input type="checkbox" id="isPublic" name="isPublic">
                        <label for="isPublic">ë‹¤ë¥¸ ì‚¬ìš©ìì™€ ê³µìœ  (ê³µê°œ ë©˜í† ë¡œ ì„¤ì •)</label>
                    </div>
                </div>
                
                <!-- ì§€ì‹ ì¶”ê°€ ì„¹ì…˜ -->
                <div class="knowledge-section">
                    <h3>ğŸ“š ë©˜í†  ì§€ì‹ ê´€ë¦¬</h3>
                    <p>ë©˜í† ì˜ ë°°ê²½ ì§€ì‹ì„ ì¶”ê°€í•˜ê±°ë‚˜ ìˆ˜ì •í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>
                    
                    <div class="knowledge-type-tabs">
                        <button type="button" class="knowledge-tab active" data-type="text">
                            ğŸ“ ì§ì ‘ ì…ë ¥
                        </button>
                        <button type="button" class="knowledge-tab" data-type="pdf">
                            ğŸ“„ PDF ì—…ë¡œë“œ
                        </button>
                        <button type="button" class="knowledge-tab" data-type="youtube">
                            ğŸ¥ ìœ íŠœë¸Œ ë§í¬
                        </button>
                        <button type="button" class="knowledge-tab" data-type="website">
                            ğŸŒ ì›¹ì‚¬ì´íŠ¸ ë§í¬
                        </button>
                    </div>
                    
                    <!-- ì§ì ‘ ì…ë ¥ -->
                    <div class="knowledge-content active" id="text-content">
                        <div class="form-group">
                            <label for="knowledgeTitle">ì§€ì‹ ì œëª©</label>
                            <input type="text" id="knowledgeTitle" placeholder="ì˜ˆ: JavaScript ê¸°ì´ˆ ê°œë…">
                        </div>
                        <div class="form-group">
                            <label for="knowledgeText">ì§€ì‹ ë‚´ìš©</label>
                            <textarea id="knowledgeText" placeholder="ë©˜í† ê°€ ì•Œì•„ì•¼ í•  ì§€ì‹ì´ë‚˜ ì •ë³´ë¥¼ ì…ë ¥í•˜ì„¸ìš”..." 
                                      rows="8"></textarea>
                        </div>
                        <button type="button" class="btn btn-secondary" onclick="addTextKnowledge()">
                            ì¶”ê°€í•˜ê¸°
                        </button>
                    </div>
                    
                    <!-- PDF ì—…ë¡œë“œ -->
                    <div class="knowledge-content" id="pdf-content">
                        <div class="file-upload-area" id="pdfUploadArea">
                            <div style="font-size: 2rem; margin-bottom: 1rem;">ğŸ“„</div>
                            <p>PDF íŒŒì¼ì„ ë“œë˜ê·¸í•˜ê±°ë‚˜ í´ë¦­í•˜ì—¬ ì—…ë¡œë“œí•˜ì„¸ìš”</p>
                            <input type="file" id="pdfFileInput" accept=".pdf" style="display: none;">
                            <button type="button" class="btn btn-secondary" onclick="document.getElementById('pdfFileInput').click()">
                                íŒŒì¼ ì„ íƒ
                            </button>
                        </div>
                    </div>
                    
                    <!-- ìœ íŠœë¸Œ ë§í¬ -->
                    <div class="knowledge-content" id="youtube-content">
                        <div class="form-group">
                            <label for="youtubeUrl">ìœ íŠœë¸Œ URL</label>
                            <input type="url" id="youtubeUrl" placeholder="https://www.youtube.com/watch?v=...">
                        </div>
                        <button type="button" class="btn btn-secondary" onclick="addYoutubeKnowledge()">
                            ì¶”ê°€í•˜ê¸°
                        </button>
                    </div>
                    
                    <!-- ì›¹ì‚¬ì´íŠ¸ ë§í¬ -->
                    <div class="knowledge-content" id="website-content">
                        <div class="form-group">
                            <label for="websiteUrl">ì›¹ì‚¬ì´íŠ¸ URL</label>
                            <input type="url" id="websiteUrl" placeholder="https://example.com">
                        </div>
                        <button type="button" class="btn btn-secondary" onclick="addWebsiteKnowledge()">
                            ì¶”ê°€í•˜ê¸°
                        </button>
                    </div>
                    
                    <!-- ê¸°ì¡´ ì§€ì‹ ëª©ë¡ -->
                    <div id="knowledgeList" style="margin-top: 2rem;">
                        <!-- ê¸°ì¡´ ì§€ì‹ë“¤ì´ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤ -->
                    </div>
                </div>
                
                <div class="form-actions">
                    <div class="left">
                        <button type="button" class="btn btn-danger" id="deleteBtn" onclick="deleteMentor()">
                            ğŸ—‘ï¸ ë©˜í†  ì‚­ì œ
                        </button>
                    </div>
                    <div class="right">
                        <a href="/mentors.html" class="btn btn-secondary">ì·¨ì†Œ</a>
                        <button type="submit" class="btn btn-primary" id="updateBtn">
                            ğŸ’¾ ì €ì¥í•˜ê¸°
                        </button>
                    </div>
                </div>
            </form>
        </div>
    </div>

    <script>
        let mentorId = null;
        let knowledgeData = [];
        let currentMentorData = null;
        
        document.addEventListener('DOMContentLoaded', () => {
            // URLì—ì„œ ë©˜í†  ID ê°€ì ¸ì˜¤ê¸°
            const urlParams = new URLSearchParams(window.location.search);
            mentorId = urlParams.get('id');
            
            if (!mentorId) {
                showError('ë©˜í†  IDê°€ ì—†ìŠµë‹ˆë‹¤.');
                return;
            }
            
            // ë©˜í†  ë°ì´í„° ë¡œë“œ
            loadMentorData();
            
            // íƒ­ ì „í™˜ ê¸°ëŠ¥
            document.querySelectorAll('.knowledge-tab').forEach(tab => {
                tab.addEventListener('click', () => {
                    const type = tab.dataset.type;
                    switchKnowledgeTab(type);
                });
            });
            
            // í¼ ì œì¶œ ì²˜ë¦¬
            document.getElementById('mentorForm').addEventListener('submit', handleFormSubmit);
            
            // ì´ë¦„ ë³€ê²½ ì‹œ ì•„ë°”íƒ€ ì—…ë°ì´íŠ¸
            document.getElementById('mentorName').addEventListener('input', updateAvatar);
            
            // PDF ë“œë˜ê·¸ ì•¤ ë“œë¡­
            setupPdfDragDrop();
        });
        
        // ë©˜í†  ë°ì´í„° ë¡œë“œ
        async function loadMentorData() {
            try {
                const token = localStorage.getItem('authToken');
                if (!token) {
                    window.location.href = '/login.html';
                    return;
                }
                
                // ì‹¤ì œ API í˜¸ì¶œ (í˜„ì¬ëŠ” ë°ëª¨ ë°ì´í„° ì‚¬ìš©)
                // const response = await fetch(`/api/mentors/${mentorId}`, {
                //     headers: { 'Authorization': `Bearer ${token}` }
                // });
                // const result = await response.json();
                
                // ë°ëª¨ ë°ì´í„° (ì‹¤ì œë¡œëŠ” APIì—ì„œ ê°€ì ¸ì˜´)
                const demoData = getMentorDemoData(mentorId);
                
                if (demoData) {
                    currentMentorData = demoData;
                    populateForm(demoData);
                    hideLoading();
                } else {
                    showError('ë©˜í† ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
                }
            } catch (error) {
                console.error('ë©˜í†  ë°ì´í„° ë¡œë“œ ì˜¤ë¥˜:', error);
                showError('ë©˜í†  ì •ë³´ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ”ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
            }
        }
        
        // ë°ëª¨ ë°ì´í„° ìƒì„±
        function getMentorDemoData(id) {
            const mentors = {
                '1': {
                    id: 1,
                    name: 'ê°œë°œ ë©˜í†  Alex',
                    expertise: 'í”„ë¡œê·¸ë˜ë° â€¢ ì†Œí”„íŠ¸ì›¨ì–´ ì•„í‚¤í…ì²˜',
                    description: 'í’€ìŠ¤íƒ ê°œë°œê³¼ ì‹œìŠ¤í…œ ì„¤ê³„ì— ëŒ€í•œ ì „ë¬¸ ì§€ì‹ì„ ë°”íƒ•ìœ¼ë¡œ ì‹¤ë¬´ì ì¸ ì¡°ì–¸ì„ ì œê³µí•©ë‹ˆë‹¤.',
                    personality: 'professional',
                    isPublic: false,
                    knowledge: [
                        {
                            type: 'text',
                            title: 'JavaScript ê¸°ì´ˆ',
                            content: 'JavaScriptëŠ” ì›¹ ê°œë°œì˜ í•µì‹¬ ì–¸ì–´ì…ë‹ˆë‹¤...',
                            wordCount: 450
                        },
                        {
                            type: 'pdf',
                            title: 'Clean Code ê°€ì´ë“œ.pdf',
                            wordCount: 2500,
                            status: 'completed'
                        }
                    ]
                },
                '2': {
                    id: 2,
                    name: 'ë””ìì¸ ì „ë¬¸ê°€ Luna',
                    expertise: 'UI/UX ë””ìì¸ â€¢ ë¸Œëœë”©',
                    description: 'ì‚¬ìš©ì ê²½í—˜ê³¼ ì‹œê° ë””ìì¸ì— ëŒ€í•œ ê¹Šì´ ìˆëŠ” í†µì°°ì„ ì œê³µí•˜ëŠ” ë””ìì¸ ë©˜í† ì…ë‹ˆë‹¤.',
                    personality: 'friendly',
                    isPublic: true,
                    knowledge: [
                        {
                            type: 'text',
                            title: 'ë””ìì¸ ì›ì¹™',
                            content: 'ì¢‹ì€ ë””ìì¸ì˜ ê¸°ë³¸ ì›ì¹™ë“¤...',
                            wordCount: 320
                        }
                    ]
                }
            };
            
            return mentors[id];
        }
        
        // í¼ì— ë°ì´í„° ì±„ìš°ê¸°
        function populateForm(mentorData) {
            document.getElementById('mentorName').value = mentorData.name || '';
            document.getElementById('expertise').value = mentorData.expertise || '';
            document.getElementById('description').value = mentorData.description || '';
            document.getElementById('personality').value = mentorData.personality || 'friendly';
            document.getElementById('isPublic').checked = mentorData.isPublic || false;
            
            // ì•„ë°”íƒ€ ì—…ë°ì´íŠ¸
            updateAvatar();
            
            // ì§€ì‹ ë°ì´í„° ë¡œë“œ
            knowledgeData = mentorData.knowledge || [];
            renderKnowledgeList();
        }
        
        // ë¡œë”© ìˆ¨ê¸°ê¸°
        function hideLoading() {
            document.getElementById('loadingState').style.display = 'none';
            document.getElementById('formContainer').classList.add('loaded');
        }
        
        // ì—ëŸ¬ í‘œì‹œ
        function showError(message) {
            document.getElementById('loadingState').style.display = 'none';
            const errorEl = document.getElementById('errorState');
            errorEl.style.display = 'block';
            errorEl.querySelector('p').textContent = message;
        }
        
        // íƒ­ ì „í™˜
        function switchKnowledgeTab(type) {
            // ëª¨ë“  íƒ­ ë¹„í™œì„±í™”
            document.querySelectorAll('.knowledge-tab').forEach(tab => {
                tab.classList.remove('active');
            });
            document.querySelectorAll('.knowledge-content').forEach(content => {
                content.classList.remove('active');
            });
            
            // ì„ íƒëœ íƒ­ í™œì„±í™”
            document.querySelector(`[data-type="${type}"]`).classList.add('active');
            document.getElementById(`${type}-content`).classList.add('active');
        }
        
        // ì•„ë°”íƒ€ ì—…ë°ì´íŠ¸
        function updateAvatar() {
            const name = document.getElementById('mentorName').value;
            const avatar = document.getElementById('avatarPreview');
            avatar.textContent = name ? name.charAt(0).toUpperCase() : 'ğŸ¤–';
        }
        
        // í…ìŠ¤íŠ¸ ì§€ì‹ ì¶”ê°€
        function addTextKnowledge() {
            const title = document.getElementById('knowledgeTitle').value.trim();
            const content = document.getElementById('knowledgeText').value.trim();
            
            if (!title || !content) {
                alert('ì œëª©ê³¼ ë‚´ìš©ì„ ëª¨ë‘ ì…ë ¥í•´ì£¼ì„¸ìš”.');
                return;
            }
            
            const knowledge = {
                type: 'text',
                title: title,
                content: content,
                wordCount: content.split(' ').length,
                isNew: true
            };
            
            knowledgeData.push(knowledge);
            renderKnowledgeList();
            
            // ì…ë ¥ í•„ë“œ ì´ˆê¸°í™”
            document.getElementById('knowledgeTitle').value = '';
            document.getElementById('knowledgeText').value = '';
        }
        
        // ìœ íŠœë¸Œ ì§€ì‹ ì¶”ê°€
        function addYoutubeKnowledge() {
            const url = document.getElementById('youtubeUrl').value.trim();
            
            if (!url) {
                alert('ìœ íŠœë¸Œ URLì„ ì…ë ¥í•´ì£¼ì„¸ìš”.');
                return;
            }
            
            if (!url.includes('youtube.com') && !url.includes('youtu.be')) {
                alert('ì˜¬ë°”ë¥¸ ìœ íŠœë¸Œ URLì„ ì…ë ¥í•´ì£¼ì„¸ìš”.');
                return;
            }
            
            const knowledge = {
                type: 'youtube',
                title: 'ìœ íŠœë¸Œ ì˜ìƒ',
                url: url,
                status: 'processing',
                isNew: true
            };
            
            knowledgeData.push(knowledge);
            renderKnowledgeList();
            
            // ì…ë ¥ í•„ë“œ ì´ˆê¸°í™”
            document.getElementById('youtubeUrl').value = '';
            
            // ì‹¤ì œë¡œëŠ” ì—¬ê¸°ì„œ ë°±ì—”ë“œ API í˜¸ì¶œí•˜ì—¬ íŠ¸ëœìŠ¤í¬ë¦½íŠ¸ ì¶”ì¶œ
            setTimeout(() => {
                knowledge.status = 'completed';
                knowledge.wordCount = Math.floor(Math.random() * 1000) + 500;
                renderKnowledgeList();
            }, 2000);
        }
        
        // ì›¹ì‚¬ì´íŠ¸ ì§€ì‹ ì¶”ê°€
        function addWebsiteKnowledge() {
            const url = document.getElementById('websiteUrl').value.trim();
            
            if (!url) {
                alert('ì›¹ì‚¬ì´íŠ¸ URLì„ ì…ë ¥í•´ì£¼ì„¸ìš”.');
                return;
            }
            
            try {
                new URL(url);
            } catch {
                alert('ì˜¬ë°”ë¥¸ URLì„ ì…ë ¥í•´ì£¼ì„¸ìš”.');
                return;
            }
            
            const knowledge = {
                type: 'website',
                title: 'ì›¹ì‚¬ì´íŠ¸ ë‚´ìš©',
                url: url,
                status: 'processing',
                isNew: true
            };
            
            knowledgeData.push(knowledge);
            renderKnowledgeList();
            
            // ì…ë ¥ í•„ë“œ ì´ˆê¸°í™”
            document.getElementById('websiteUrl').value = '';
            
            // ì‹¤ì œë¡œëŠ” ì—¬ê¸°ì„œ ë°±ì—”ë“œ API í˜¸ì¶œí•˜ì—¬ ì›¹ ìŠ¤í¬ë˜í•‘
            setTimeout(() => {
                knowledge.status = 'completed';
                knowledge.wordCount = Math.floor(Math.random() * 2000) + 800;
                renderKnowledgeList();
            }, 3000);
        }
        
        // PDF ë“œë˜ê·¸ ì•¤ ë“œë¡­ ì„¤ì •
        function setupPdfDragDrop() {
            const uploadArea = document.getElementById('pdfUploadArea');
            const fileInput = document.getElementById('pdfFileInput');
            
            uploadArea.addEventListener('dragover', (e) => {
                e.preventDefault();
                uploadArea.classList.add('dragover');
            });
            
            uploadArea.addEventListener('dragleave', () => {
                uploadArea.classList.remove('dragover');
            });
            
            uploadArea.addEventListener('drop', (e) => {
                e.preventDefault();
                uploadArea.classList.remove('dragover');
                
                const files = e.dataTransfer.files;
                if (files.length > 0 && files[0].type === 'application/pdf') {
                    handlePdfFile(files[0]);
                } else {
                    alert('PDF íŒŒì¼ë§Œ ì—…ë¡œë“œ ê°€ëŠ¥í•©ë‹ˆë‹¤.');
                }
            });
            
            fileInput.addEventListener('change', (e) => {
                if (e.target.files.length > 0) {
                    handlePdfFile(e.target.files[0]);
                }
            });
        }
        
        // PDF íŒŒì¼ ì²˜ë¦¬
        function handlePdfFile(file) {
            if (file.size > 10 * 1024 * 1024) { // 10MB ì œí•œ
                alert('íŒŒì¼ í¬ê¸°ëŠ” 10MB ì´í•˜ë§Œ ê°€ëŠ¥í•©ë‹ˆë‹¤.');
                return;
            }
            
            const knowledge = {
                type: 'pdf',
                title: file.name,
                file: file,
                fileSize: file.size,
                status: 'processing',
                isNew: true
            };
            
            knowledgeData.push(knowledge);
            renderKnowledgeList();
            
            // ì‹¤ì œë¡œëŠ” ì—¬ê¸°ì„œ ë°±ì—”ë“œ API í˜¸ì¶œí•˜ì—¬ PDF í…ìŠ¤íŠ¸ ì¶”ì¶œ
            setTimeout(() => {
                knowledge.status = 'completed';
                knowledge.wordCount = Math.floor(Math.random() * 5000) + 1000;
                renderKnowledgeList();
            }, 4000);
        }
        
        // ì§€ì‹ ëª©ë¡ ë Œë”ë§
        function renderKnowledgeList() {
            const listEl = document.getElementById('knowledgeList');
            
            if (knowledgeData.length === 0) {
                listEl.innerHTML = '<p style="text-align: center; color: #718096;">ë“±ë¡ëœ ì§€ì‹ì´ ì—†ìŠµë‹ˆë‹¤.</p>';
                return;
            }
            
            const html = knowledgeData.map((knowledge, index) => {
                const typeIcon = {
                    text: 'ğŸ“',
                    pdf: 'ğŸ“„',
                    youtube: 'ğŸ¥',
                    website: 'ğŸŒ'
                };
                
                const statusText = {
                    processing: 'ì²˜ë¦¬ ì¤‘...',
                    completed: 'ì™„ë£Œ',
                    failed: 'ì‹¤íŒ¨'
                };
                
                const isNewBadge = knowledge.isNew ? '<span style="background: #38a169; color: white; padding: 0.2rem 0.5rem; border-radius: 4px; font-size: 0.7rem; margin-left: 0.5rem;">NEW</span>' : '';
                
                return `
                    <div class="knowledge-item">
                        <div class="info">
                            <div style="font-weight: 600;">
                                ${typeIcon[knowledge.type]} ${knowledge.title}${isNewBadge}
                            </div>
                            <div style="font-size: 0.9em; color: #718096;">
                                ${knowledge.type === 'text' ? 
                                    `${knowledge.wordCount}ë‹¨ì–´` : 
                                    `${statusText[knowledge.status]}${knowledge.wordCount ? ` â€¢ ${knowledge.wordCount}ë‹¨ì–´` : ''}`
                                }
                                ${knowledge.fileSize ? ` â€¢ ${(knowledge.fileSize / 1024 / 1024).toFixed(1)}MB` : ''}
                            </div>
                            ${knowledge.status === 'processing' ? `
                                <div class="progress-bar">
                                    <div class="progress-fill" style="width: ${Math.random() * 80 + 10}%;"></div>
                                </div>
                            ` : ''}
                        </div>
                        <button type="button" class="remove-btn" onclick="removeKnowledge(${index})">
                            ì‚­ì œ
                        </button>
                    </div>
                `;
            }).join('');
            
            listEl.innerHTML = html;
        }
        
        // ì§€ì‹ ì‚­ì œ
        function removeKnowledge(index) {
            if (confirm('ì´ ì§€ì‹ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
                knowledgeData.splice(index, 1);
                renderKnowledgeList();
            }
        }
        
        // ë©˜í†  ì‚­ì œ
        async function deleteMentor() {
            if (!confirm('ì •ë§ë¡œ ì´ ë©˜í† ë¥¼ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?\nì‚­ì œëœ ë©˜í† ëŠ” ë³µêµ¬í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.')) {
                return;
            }
            
            const deleteBtn = document.getElementById('deleteBtn');
            const originalText = deleteBtn.textContent;
            
            try {
                deleteBtn.disabled = true;
                deleteBtn.textContent = 'ì‚­ì œ ì¤‘...';
                
                const token = localStorage.getItem('authToken');
                
                // ì‹¤ì œ API í˜¸ì¶œ
                // const response = await fetch(`/api/mentors/${mentorId}`, {
                //     method: 'DELETE',
                //     headers: { 'Authorization': `Bearer ${token}` }
                // });
                // const result = await response.json();
                
                // ë°ëª¨ì—ì„œëŠ” ì„±ê³µìœ¼ë¡œ ê°€ì •
                alert('ë©˜í† ê°€ ì„±ê³µì ìœ¼ë¡œ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.');
                window.location.href = '/mentors.html';
                
            } catch (error) {
                console.error('ë©˜í†  ì‚­ì œ ì˜¤ë¥˜:', error);
                alert('ë©˜í†  ì‚­ì œ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: ' + error.message);
            } finally {
                deleteBtn.disabled = false;
                deleteBtn.textContent = originalText;
            }
        }
        
        // í¼ ì œì¶œ ì²˜ë¦¬
        async function handleFormSubmit(e) {
            e.preventDefault();
            
            const formData = new FormData(e.target);
            const mentorData = {
                name: formData.get('name'),
                expertise: formData.get('expertise'),
                description: formData.get('description'),
                personality: formData.get('personality'),
                isPublic: formData.has('isPublic'),
                knowledge: knowledgeData
            };
            
            // ê¸°ë³¸ ìœ íš¨ì„± ê²€ì‚¬
            if (!mentorData.name.trim()) {
                alert('ë©˜í†  ì´ë¦„ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.');
                return;
            }
            
            const updateBtn = document.getElementById('updateBtn');
            const originalText = updateBtn.textContent;
            
            try {
                updateBtn.disabled = true;
                updateBtn.textContent = 'ì €ì¥ ì¤‘...';
                
                const token = localStorage.getItem('authToken');
                
                // ì‹¤ì œ API í˜¸ì¶œ
                // const response = await fetch(`/api/mentors/${mentorId}`, {
                //     method: 'PUT',
                //     headers: {
                //         'Authorization': `Bearer ${token}`,
                //         'Content-Type': 'application/json'
                //     },
                //     body: JSON.stringify(mentorData)
                // });
                // const result = await response.json();
                
                // ë°ëª¨ì—ì„œëŠ” ì„±ê³µìœ¼ë¡œ ê°€ì •
                alert('ë©˜í†  ì •ë³´ê°€ ì„±ê³µì ìœ¼ë¡œ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤!');
                window.location.href = '/mentors.html';
                
            } catch (error) {
                console.error('ë©˜í†  ì—…ë°ì´íŠ¸ ì˜¤ë¥˜:', error);
                alert('ë©˜í†  ì •ë³´ ì €ì¥ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: ' + error.message);
            } finally {
                updateBtn.disabled = false;
                updateBtn.textContent = originalText;
            }
        }
    </script>
    
    <!-- PBT LMS ì±—ë´‡ -->
    <script src="/js/chatbot.js"></script>
</body>
</html>