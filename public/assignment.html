<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Í≥ºÏ†ú - PBT LMS</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            line-height: 1.6;
        }
        
        .navbar {
            background: rgba(255, 255, 255, 0.95);
            padding: 1rem 2rem;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
            backdrop-filter: blur(10px);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .navbar .logo {
            font-size: 1.5rem;
            font-weight: 700;
            color: #4a5568;
        }
        
        .navbar .nav-links {
            display: flex;
            gap: 1rem;
            align-items: center;
        }
        
        .navbar .nav-link {
            color: #4a5568;
            text-decoration: none;
            padding: 0.5rem 1rem;
            border-radius: 8px;
            transition: all 0.3s ease;
        }
        
        .navbar .nav-link:hover {
            background: rgba(102, 126, 234, 0.1);
            color: #667eea;
        }
        
        .navbar .logout-btn {
            padding: 0.5rem 1rem;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 500;
            transition: all 0.3s ease;
        }
        
        .container {
            max-width: 1200px;
            margin: 2rem auto;
            padding: 0 2rem;
        }
        
        .breadcrumb {
            background: rgba(255, 255, 255, 0.95);
            padding: 1rem 1.5rem;
            border-radius: 10px;
            margin-bottom: 1.5rem;
            font-size: 0.9rem;
            color: #718096;
        }
        
        .breadcrumb a {
            color: #667eea;
            text-decoration: none;
        }
        
        .assignment-header {
            background: rgba(255, 255, 255, 0.95);
            padding: 2rem;
            border-radius: 15px;
            margin-bottom: 2rem;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.15);
        }
        
        .assignment-title {
            font-size: 2rem;
            color: #4a5568;
            margin-bottom: 1rem;
        }
        
        .assignment-meta {
            display: flex;
            gap: 2rem;
            margin-bottom: 1.5rem;
            flex-wrap: wrap;
        }
        
        .meta-item {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            color: #718096;
        }
        
        .assignment-status {
            display: inline-block;
            padding: 0.5rem 1rem;
            border-radius: 20px;
            font-size: 0.9rem;
            font-weight: 500;
            margin-bottom: 1rem;
        }
        
        .status-pending {
            background: #fed7d7;
            color: #c53030;
        }
        
        .status-submitted {
            background: #bee3f8;
            color: #2b6cb0;
        }
        
        .status-graded {
            background: #c6f6d5;
            color: #2f855a;
        }
        
        .content-grid {
            display: grid;
            grid-template-columns: 2fr 1fr;
            gap: 2rem;
        }
        
        .main-content {
            display: flex;
            flex-direction: column;
            gap: 2rem;
        }
        
        .sidebar {
            display: flex;
            flex-direction: column;
            gap: 2rem;
        }
        
        .section {
            background: rgba(255, 255, 255, 0.95);
            padding: 1.5rem;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.15);
        }
        
        .section-title {
            font-size: 1.3rem;
            color: #4a5568;
            margin-bottom: 1rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        
        .assignment-description {
            color: #4a5568;
            line-height: 1.7;
            margin-bottom: 1.5rem;
        }
        
        .file-upload-area {
            border: 2px dashed #cbd5e0;
            border-radius: 10px;
            padding: 2rem;
            text-align: center;
            transition: all 0.3s ease;
            cursor: pointer;
            margin-bottom: 1rem;
        }
        
        .file-upload-area:hover {
            border-color: #667eea;
            background: rgba(102, 126, 234, 0.05);
        }
        
        .file-upload-area.dragover {
            border-color: #667eea;
            background: rgba(102, 126, 234, 0.1);
        }
        
        .file-upload-icon {
            font-size: 3rem;
            color: #cbd5e0;
            margin-bottom: 1rem;
        }
        
        .file-list {
            margin-bottom: 1rem;
        }
        
        .file-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0.8rem;
            background: #f7fafc;
            border-radius: 8px;
            margin-bottom: 0.5rem;
        }
        
        .file-info {
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        
        .file-icon {
            font-size: 1.2rem;
        }
        
        .remove-file {
            color: #e53e3e;
            cursor: pointer;
            padding: 0.25rem;
            border-radius: 4px;
            transition: background 0.3s ease;
        }
        
        .remove-file:hover {
            background: #fed7d7;
        }
        
        .text-submission {
            width: 100%;
            min-height: 150px;
            padding: 1rem;
            border: 1px solid #cbd5e0;
            border-radius: 8px;
            font-family: inherit;
            resize: vertical;
            margin-bottom: 1rem;
        }
        
        .btn {
            padding: 0.8rem 1.5rem;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 500;
            transition: all 0.3s ease;
            text-decoration: none;
            text-align: center;
            font-size: 0.9rem;
        }
        
        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }
        
        .btn-secondary {
            background: transparent;
            color: #667eea;
            border: 2px solid #667eea;
        }
        
        .btn-danger {
            background: #e53e3e;
            color: white;
        }
        
        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.3);
        }
        
        .btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }
        
        .submission-history {
            margin-top: 1rem;
        }
        
        .submission-item {
            border: 1px solid #e2e8f0;
            border-radius: 8px;
            padding: 1rem;
            margin-bottom: 1rem;
        }
        
        .submission-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 0.5rem;
        }
        
        .submission-meta {
            font-size: 0.9rem;
            color: #718096;
        }
        
        .score-display {
            font-size: 1.5rem;
            font-weight: 700;
            color: #2f855a;
            text-align: center;
            margin-bottom: 1rem;
        }
        
        .feedback-box {
            background: #f7fafc;
            padding: 1rem;
            border-radius: 8px;
            border-left: 4px solid #667eea;
        }
        
        .loading {
            display: none;
            text-align: center;
            padding: 1rem;
        }
        
        .spinner {
            border: 3px solid #f3f3f3;
            border-top: 3px solid #667eea;
            border-radius: 50%;
            width: 30px;
            height: 30px;
            animation: spin 1s linear infinite;
            margin: 0 auto 0.5rem;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        @media (max-width: 768px) {
            .navbar {
                padding: 1rem;
                flex-direction: column;
                gap: 1rem;
            }
            
            .container {
                padding: 0 1rem;
            }
            
            .content-grid {
                grid-template-columns: 1fr;
            }
            
            .assignment-meta {
                flex-direction: column;
                gap: 1rem;
            }
        }
    </style>
</head>
<body>
    <nav class="navbar">
        <div class="logo">üß© PBT LMS</div>
        <div class="nav-links">
            <a href="/dashboard.html" class="nav-link">ÎåÄÏãúÎ≥¥Îìú</a>
            <a href="/courses.html" class="nav-link">ÎÇ¥ Í≥ºÏ†ï</a>
            <a href="/problems.html" class="nav-link">Î¨∏Ï†ú ÌíÄÏù¥</a>
            <a href="/discussions.html" class="nav-link">ÌÜ†Î°†</a>
            <button class="logout-btn" onclick="logout()">Î°úÍ∑∏ÏïÑÏõÉ</button>
        </div>
    </nav>
    
    <div class="container">
        <div class="breadcrumb">
            <a href="/courses.html">ÎÇ¥ Í≥ºÏ†ï</a> > 
            <a href="#" id="course-link">JavaScript Í∏∞Ï¥à ÌîÑÎ°úÍ∑∏ÎûòÎ∞ç</a> > 
            <span id="assignment-breadcrumb">Í≥ºÏ†ú</span>
        </div>
        
        <div class="assignment-header">
            <h1 class="assignment-title" id="assignment-title">Í≥ºÏ†ú Ï†úÎ™©</h1>
            <div class="assignment-meta">
                <div class="meta-item">
                    <span>üìÖ</span>
                    <span>ÎßàÍ∞êÏùº: <span id="due-date">2025-06-01 23:59</span></span>
                </div>
                <div class="meta-item">
                    <span>üìä</span>
                    <span>Î∞∞Ï†ê: <span id="max-score">100</span>Ï†ê</span>
                </div>
                <div class="meta-item">
                    <span>üìù</span>
                    <span>Ïú†Ìòï: <span id="assignment-type">ÌååÏùº Ï†úÏ∂ú</span></span>
                </div>
                <div class="meta-item">
                    <span>üîÑ</span>
                    <span>Ï†úÏ∂ú ÌöüÏàò: <span id="submission-count">1/3</span></span>
                </div>
            </div>
            <div class="assignment-status" id="assignment-status">ÎØ∏Ï†úÏ∂ú</div>
        </div>
        
        <div class="content-grid">
            <div class="main-content">
                <!-- Í≥ºÏ†ú ÏÑ§Î™Ö -->
                <div class="section">
                    <h2 class="section-title">üìã Í≥ºÏ†ú ÏÑ§Î™Ö</h2>
                    <div class="assignment-description" id="assignment-description">
                        JavaScript Ìï®ÏàòÏôÄ Ïä§ÏΩîÌîÑÏóê ÎåÄÌïú Ïã§Ïäµ Í≥ºÏ†úÏûÖÎãàÎã§. 
                        Ï£ºÏñ¥ÏßÑ ÏöîÍµ¨ÏÇ¨Ìï≠Ïóê Îî∞Îùº JavaScript Ìï®ÏàòÎ•º ÏûëÏÑ±ÌïòÍ≥† Í≤∞Í≥ºÎ•º Ï†úÏ∂úÌï¥Ï£ºÏÑ∏Ïöî.
                    </div>
                </div>
                
                <!-- Ï†úÏ∂ú ÏòÅÏó≠ -->
                <div class="section" id="submission-section">
                    <h2 class="section-title">üì§ Í≥ºÏ†ú Ï†úÏ∂ú</h2>
                    
                    <!-- ÌååÏùº Ï†úÏ∂ú -->
                    <div id="file-submission" style="display: block;">
                        <div class="file-upload-area" onclick="document.getElementById('file-input').click()">
                            <div class="file-upload-icon">üìÅ</div>
                            <p>ÌååÏùºÏùÑ ÌÅ¥Î¶≠ÌïòÍ±∞ÎÇò ÎìúÎûòÍ∑∏ÌïòÏó¨ ÏóÖÎ°úÎìúÌïòÏÑ∏Ïöî</p>
                            <small>ÏßÄÏõê ÌòïÏãù: .js, .html, .css, .zip (ÏµúÎåÄ 10MB)</small>
                        </div>
                        <input type="file" id="file-input" style="display: none;" multiple accept=".js,.html,.css,.zip,.txt,.pdf">
                        
                        <div class="file-list" id="file-list"></div>
                    </div>
                    
                    <!-- ÌÖçÏä§Ìä∏ Ï†úÏ∂ú -->
                    <div id="text-submission" style="display: none;">
                        <textarea class="text-submission" id="submission-text" placeholder="Í≥ºÏ†ú ÎÇ¥Ïö©ÏùÑ ÏûÖÎ†•ÌïòÏÑ∏Ïöî..."></textarea>
                    </div>
                    
                    <div class="loading" id="upload-loading">
                        <div class="spinner"></div>
                        <p>Ï†úÏ∂ú Ï§ë...</p>
                    </div>
                    
                    <div style="display: flex; gap: 1rem; margin-top: 1rem;">
                        <button class="btn btn-primary" onclick="submitAssignment()" id="submit-btn">
                            üì§ Í≥ºÏ†ú Ï†úÏ∂ú
                        </button>
                        <button class="btn btn-secondary" onclick="saveDraft()" id="save-btn">
                            üíæ ÏûÑÏãú Ï†ÄÏû•
                        </button>
                        <button class="btn btn-danger" onclick="clearSubmission()" id="clear-btn">
                            üóëÔ∏è Ï¥àÍ∏∞Ìôî
                        </button>
                    </div>
                </div>
                
                <!-- Ï†úÏ∂ú ÎÇ¥Ïó≠ -->
                <div class="section">
                    <h2 class="section-title">üìÑ Ï†úÏ∂ú ÎÇ¥Ïó≠</h2>
                    <div id="submission-history">
                        <!-- Ï†úÏ∂ú ÎÇ¥Ïó≠Ïù¥ Ïó¨Í∏∞Ïóê ÎèôÏ†ÅÏúºÎ°ú Ï∂îÍ∞ÄÎê©ÎãàÎã§ -->
                    </div>
                </div>
            </div>
            
            <!-- ÏÇ¨Ïù¥ÎìúÎ∞î -->
            <div class="sidebar">
                <!-- Ï†êÏàò Î∞è ÌîºÎìúÎ∞± -->
                <div class="section" id="grade-section" style="display: none;">
                    <h3 class="section-title">üéØ Ï†êÏàò</h3>
                    <div class="score-display" id="final-score">85/100</div>
                    <div class="feedback-box">
                        <h4>Í∞ïÏÇ¨ ÌîºÎìúÎ∞±</h4>
                        <div id="instructor-feedback">
                            Ï†ÑÎ∞òÏ†ÅÏúºÎ°ú Ïûò ÏûëÏÑ±ÎêòÏóàÏäµÎãàÎã§. Îã§Îßå ÏòàÏô∏ Ï≤òÎ¶¨ Î∂ÄÎ∂ÑÏùÑ Îçî Î≥¥ÏôÑÌïòÎ©¥ Ï¢ãÍ≤†ÏäµÎãàÎã§.
                        </div>
                    </div>
                </div>
                
                <!-- Í≥ºÏ†ú ÏöîÍµ¨ÏÇ¨Ìï≠ -->
                <div class="section">
                    <h3 class="section-title">üìå ÏöîÍµ¨ÏÇ¨Ìï≠</h3>
                    <ul id="requirements-list">
                        <li>Ìï®Ïàò ÏÑ†Ïñ∏Í≥º ÌëúÌòÑÏãùÏùò Ï∞®Ïù¥Ï†ê Íµ¨ÌòÑ</li>
                        <li>ÌÅ¥Î°úÏ†ÄÎ•º ÌôúÏö©Ìïú Ïπ¥Ïö¥ÌÑ∞ Ìï®Ïàò ÏûëÏÑ±</li>
                        <li>Ïä§ÏΩîÌîÑ Ï≤¥Ïù∏ Ïù¥Ìï¥Î•º Î≥¥Ïó¨Ï£ºÎäî ÏòàÏ†ú</li>
                        <li>Ï†ÅÏ†àÌïú Ï£ºÏÑùÍ≥º ÏÑ§Î™Ö Ìè¨Ìï®</li>
                    </ul>
                </div>
                
                <!-- Ï∞∏Í≥† ÏûêÎ£å -->
                <div class="section">
                    <h3 class="section-title">üìö Ï∞∏Í≥† ÏûêÎ£å</h3>
                    <div id="reference-materials">
                        <a href="#" class="btn btn-secondary" style="display: block; margin-bottom: 0.5rem;">
                            üìÑ Ìï®Ïàò Ï∞∏Í≥† Î¨∏ÏÑú
                        </a>
                        <a href="#" class="btn btn-secondary" style="display: block; margin-bottom: 0.5rem;">
                            üé• Ïä§ÏΩîÌîÑ ÏÑ§Î™Ö ÏòÅÏÉÅ
                        </a>
                        <a href="#" class="btn btn-secondary" style="display: block;">
                            üíª ÏòàÏ†ú ÏΩîÎìú ÌÖúÌîåÎ¶ø
                        </a>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // URLÏóêÏÑú Í≥ºÏ†ï IDÏôÄ Í≥ºÏ†ú ID Ï∂îÏ∂ú
        const urlParams = new URLSearchParams(window.location.search);
        const courseId = urlParams.get('courseId');
        const assignmentId = urlParams.get('assignmentId');
        
        let selectedFiles = [];
        
        // ÌéòÏù¥ÏßÄ Î°úÎìú Ïãú Ï¥àÍ∏∞Ìôî
        document.addEventListener('DOMContentLoaded', async () => {
            if (!courseId || !assignmentId) {
                alert('ÏûòÎ™ªÎêú Ï†ëÍ∑ºÏûÖÎãàÎã§.');
                history.back();
                return;
            }
            
            const token = localStorage.getItem('authToken');
            if (!token) {
                alert('Î°úÍ∑∏Ïù∏Ïù¥ ÌïÑÏöîÌï©ÎãàÎã§.');
                window.location.href = '/login.html';
                return;
            }
            
            await loadAssignmentDetail(courseId, assignmentId);
            setupFileUpload();
        });
        
        // Í≥ºÏ†ú ÏÉÅÏÑ∏ Ï†ïÎ≥¥ Î°úÎìú
        async function loadAssignmentDetail(courseId, assignmentId) {
            try {
                const token = localStorage.getItem('authToken');
                
                // Ïã§Ï†ú API Ìò∏Ï∂ú
                const response = await fetch(`/api/assignments/${assignmentId}`, {
                    headers: {
                        'Authorization': `Bearer ${token}`,
                        'Content-Type': 'application/json'
                    }
                });
                
                if (response.ok) {
                    const result = await response.json();
                    const assignment = result.data;
                    
                    if (!assignment) {
                        throw new Error('Í≥ºÏ†ú Îç∞Ïù¥ÌÑ∞Í∞Ä ÏóÜÏäµÎãàÎã§');
                    }
                    
                    // Í≥ºÏ†ú Ï†ïÎ≥¥ ÌëúÏãú
                    document.getElementById('assignment-title').textContent = assignment.title;
                    document.getElementById('assignment-breadcrumb').textContent = assignment.title;
                    document.getElementById('due-date').textContent = new Date(assignment.dueDate).toLocaleString('ko-KR');
                    document.getElementById('max-score').textContent = assignment.maxScore;
                    document.getElementById('assignment-type').textContent = getTypeText(assignment.type);
                    document.getElementById('assignment-description').textContent = assignment.description;
                    document.getElementById('course-link').href = `/course-detail.html?id=${courseId}`;
                    
                    // Ï†úÏ∂ú ÌöüÏàò Í≥ÑÏÇ∞
                    const submissionCount = assignment.userSubmissions ? assignment.userSubmissions.length : 0;
                    const maxSubmissions = assignment.maxSubmissions || 1;
                    document.getElementById('submission-count').textContent = `${submissionCount}/${maxSubmissions}`;
                    
                    // ÏÉÅÌÉú Î∞è Ï†êÏàò ÌëúÏãú
                    let status = 'pending';
                    let score = null;
                    if (assignment.userSubmissions && assignment.userSubmissions.length > 0) {
                        const latestSubmission = assignment.userSubmissions[0];
                        status = latestSubmission.status;
                        score = latestSubmission.score;
                    }
                    
                    const statusElement = document.getElementById('assignment-status');
                    const statusText = getStatusText(status);
                    statusElement.textContent = statusText;
                    statusElement.className = `assignment-status status-${status}`;
                    
                    // Ï†êÏàò Î∞è ÌîºÎìúÎ∞± ÌëúÏãú
                    if (score !== null) {
                        document.getElementById('grade-section').style.display = 'block';
                        document.getElementById('final-score').textContent = `${score}/${assignment.maxScore}`;
                        if (assignment.userSubmissions[0].feedback) {
                            document.getElementById('instructor-feedback').textContent = assignment.userSubmissions[0].feedback;
                        }
                    }
                    
                    // Ï†úÏ∂ú ÌÉÄÏûÖÏóê Îî∞Î•∏ UI ÏÑ§Ï†ï
                    if (assignment.type === 'quiz') {
                        document.getElementById('submission-section').style.display = 'none';
                    } else if (assignment.type === 'text') {
                        document.getElementById('file-submission').style.display = 'none';
                        document.getElementById('text-submission').style.display = 'block';
                    }
                    
                    // Ï†úÏ∂ú ÏôÑÎ£åÎêú Í≤ΩÏö∞ Ï†úÏ∂ú Î≤ÑÌäº ÎπÑÌôúÏÑ±Ìôî
                    if (status === 'completed' || status === 'graded' || submissionCount >= maxSubmissions) {
                        document.getElementById('submit-btn').disabled = true;
                        document.getElementById('submit-btn').textContent = 'Ï†úÏ∂ú ÏôÑÎ£å';
                    }
                    
                    // Ï†úÏ∂ú ÎÇ¥Ïó≠ Î°úÎìú
                    loadSubmissionHistory(assignment);
                    
                } else {
                    throw new Error('API Ìò∏Ï∂ú Ïã§Ìå®');
                }
                
            } catch (error) {
                console.error('Í≥ºÏ†ú Î°úÎìú Ïò§Î•ò:', error);
                
                // Ïò§Î•ò Ïãú ÏÉòÌîå Îç∞Ïù¥ÌÑ∞ ÏÇ¨Ïö©
                const assignments = {
                    '1': {
                        id: 1,
                        title: 'Í∏∞Î≥∏ Î¨∏Î≤ï ÌÄ¥Ï¶à',
                        description: 'Î≥ÄÏàò, Ïó∞ÏÇ∞Ïûê, Ï°∞Í±¥Î¨∏Ïóê ÎåÄÌïú Í∏∞Î≥∏ ÌÄ¥Ï¶àÏûÖÎãàÎã§.',
                        type: 'quiz',
                        maxScore: 50,
                        dueDate: '2025-05-30 23:59',
                        status: 'completed',
                        score: 85,
                        feedback: 'Î¨∏Î≤ï Ïù¥Ìï¥ÎèÑÍ∞Ä Ïö∞ÏàòÌï©ÎãàÎã§.',
                        submissionCount: '1/1'
                    },
                    '2': {
                        id: 2,
                        title: 'Ìï®Ïàò Ïã§Ïäµ Í≥ºÏ†ú',
                        description: 'JavaScript Ìï®ÏàòÏôÄ Ïä§ÏΩîÌîÑÏóê ÎåÄÌïú Ïã§Ïäµ Í≥ºÏ†úÏûÖÎãàÎã§. Ï£ºÏñ¥ÏßÑ ÏöîÍµ¨ÏÇ¨Ìï≠Ïóê Îî∞Îùº JavaScript Ìï®ÏàòÎ•º ÏûëÏÑ±ÌïòÍ≥† Í≤∞Í≥ºÎ•º Ï†úÏ∂úÌï¥Ï£ºÏÑ∏Ïöî.',
                        type: 'file',
                        maxScore: 100,
                        dueDate: '2025-06-01 23:59',
                        status: 'submitted',
                        score: null,
                        feedback: null,
                        submissionCount: '1/3'
                    },
                    '3': {
                        id: 3,
                        title: 'ÌîÑÎ°úÏ†ùÌä∏ Í≥ºÏ†ú',
                        description: 'Í∞ÑÎã®Ìïú Ïõπ Ïï†ÌîåÎ¶¨ÏºÄÏù¥ÏÖòÏùÑ Ï†úÏûëÌïòÎäî ÌîÑÎ°úÏ†ùÌä∏ Í≥ºÏ†úÏûÖÎãàÎã§.',
                        type: 'project',
                        maxScore: 150,
                        dueDate: '2025-06-15 23:59',
                        status: 'pending',
                        score: null,
                        feedback: null,
                        submissionCount: '0/2'
                    }
                };
                
                const assignment = assignments[assignmentId];
                if (!assignment) {
                    alert('Ï°¥Ïû¨ÌïòÏßÄ ÏïäÎäî Í≥ºÏ†úÏûÖÎãàÎã§.');
                    history.back();
                    return;
                }
                
                // ÏÉòÌîå Îç∞Ïù¥ÌÑ∞Î°ú ÌëúÏãú
                document.getElementById('assignment-title').textContent = assignment.title;
                document.getElementById('assignment-breadcrumb').textContent = assignment.title;
                document.getElementById('due-date').textContent = assignment.dueDate;
                document.getElementById('max-score').textContent = assignment.maxScore;
                document.getElementById('assignment-type').textContent = getTypeText(assignment.type);
                document.getElementById('submission-count').textContent = assignment.submissionCount;
                document.getElementById('assignment-description').textContent = assignment.description;
                document.getElementById('course-link').href = `/course-detail.html?id=${courseId}`;
                
                // ÏÉÅÌÉú ÌëúÏãú
                const statusElement = document.getElementById('assignment-status');
                const statusText = getStatusText(assignment.status);
                statusElement.textContent = statusText;
                statusElement.className = `assignment-status status-${assignment.status}`;
                
                // Ï†êÏàò Î∞è ÌîºÎìúÎ∞± ÌëúÏãú
                if (assignment.score !== null) {
                    document.getElementById('grade-section').style.display = 'block';
                    document.getElementById('final-score').textContent = `${assignment.score}/${assignment.maxScore}`;
                    if (assignment.feedback) {
                        document.getElementById('instructor-feedback').textContent = assignment.feedback;
                    }
                }
                
                // Ï†úÏ∂ú ÌÉÄÏûÖÏóê Îî∞Î•∏ UI ÏÑ§Ï†ï
                if (assignment.type === 'quiz') {
                    document.getElementById('submission-section').style.display = 'none';
                } else if (assignment.type === 'text') {
                    document.getElementById('file-submission').style.display = 'none';
                    document.getElementById('text-submission').style.display = 'block';
                }
                
                // Ï†úÏ∂ú ÏôÑÎ£åÎêú Í≤ΩÏö∞ Ï†úÏ∂ú Î≤ÑÌäº ÎπÑÌôúÏÑ±Ìôî
                if (assignment.status === 'completed' || assignment.status === 'graded') {
                    document.getElementById('submit-btn').disabled = true;
                    document.getElementById('submit-btn').textContent = 'Ï†úÏ∂ú ÏôÑÎ£å';
                }
                
                // Ï†úÏ∂ú ÎÇ¥Ïó≠ Î°úÎìú
                loadSubmissionHistory(assignment);
            }
        }
        
        // ÌååÏùº ÏóÖÎ°úÎìú ÏÑ§Ï†ï
        function setupFileUpload() {
            const fileInput = document.getElementById('file-input');
            const uploadArea = document.querySelector('.file-upload-area');
            
            fileInput.addEventListener('change', handleFileSelect);
            
            // ÎìúÎûòÍ∑∏ Ïï§ ÎìúÎ°≠
            uploadArea.addEventListener('dragover', (e) => {
                e.preventDefault();
                uploadArea.classList.add('dragover');
            });
            
            uploadArea.addEventListener('dragleave', () => {
                uploadArea.classList.remove('dragover');
            });
            
            uploadArea.addEventListener('drop', (e) => {
                e.preventDefault();
                uploadArea.classList.remove('dragover');
                handleFileSelect({ target: { files: e.dataTransfer.files } });
            });
        }
        
        // ÌååÏùº ÏÑ†ÌÉù Ï≤òÎ¶¨
        function handleFileSelect(event) {
            const files = Array.from(event.target.files);
            
            files.forEach(file => {
                if (validateFile(file)) {
                    selectedFiles.push(file);
                }
            });
            
            updateFileList();
        }
        
        // ÌååÏùº Í≤ÄÏ¶ù
        function validateFile(file) {
            const maxSize = 10 * 1024 * 1024; // 10MB
            const allowedTypes = ['.js', '.html', '.css', '.zip', '.txt', '.pdf'];
            
            if (file.size > maxSize) {
                alert(`ÌååÏùº ÌÅ¨Í∏∞Í∞Ä ÎÑàÎ¨¥ ÌÅΩÎãàÎã§: ${file.name} (ÏµúÎåÄ 10MB)`);
                return false;
            }
            
            const extension = '.' + file.name.split('.').pop().toLowerCase();
            if (!allowedTypes.includes(extension)) {
                alert(`ÏßÄÏõêÌïòÏßÄ ÏïäÎäî ÌååÏùº ÌòïÏãùÏûÖÎãàÎã§: ${file.name}`);
                return false;
            }
            
            return true;
        }
        
        // ÌååÏùº Î™©Î°ù ÏóÖÎç∞Ïù¥Ìä∏
        function updateFileList() {
            const fileList = document.getElementById('file-list');
            
            if (selectedFiles.length === 0) {
                fileList.innerHTML = '';
                return;
            }
            
            fileList.innerHTML = selectedFiles.map((file, index) => `
                <div class="file-item">
                    <div class="file-info">
                        <span class="file-icon">üìÑ</span>
                        <span>${file.name}</span>
                        <small>(${formatFileSize(file.size)})</small>
                    </div>
                    <span class="remove-file" onclick="removeFile(${index})">‚ùå</span>
                </div>
            `).join('');
        }
        
        // ÌååÏùº Ï†úÍ±∞
        function removeFile(index) {
            selectedFiles.splice(index, 1);
            updateFileList();
        }
        
        // ÌååÏùº ÌÅ¨Í∏∞ Ìè¨Îß∑
        function formatFileSize(bytes) {
            if (bytes === 0) return '0 Bytes';
            const k = 1024;
            const sizes = ['Bytes', 'KB', 'MB'];
            const i = Math.floor(Math.log(bytes) / Math.log(k));
            return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
        }
        
        // Í≥ºÏ†ú Ï†úÏ∂ú
        async function submitAssignment() {
            const submitBtn = document.getElementById('submit-btn');
            const loading = document.getElementById('upload-loading');
            
            if (selectedFiles.length === 0 && !document.getElementById('submission-text').value.trim()) {
                alert('Ï†úÏ∂úÌï† ÎÇ¥Ïö©Ïù¥ ÏóÜÏäµÎãàÎã§.');
                return;
            }
            
            if (!confirm('Í≥ºÏ†úÎ•º Ï†úÏ∂úÌïòÏãúÍ≤†ÏäµÎãàÍπå? Ï†úÏ∂ú ÌõÑÏóêÎäî ÏàòÏ†ïÌï† Ïàò ÏóÜÏäµÎãàÎã§.')) {
                return;
            }
            
            try {
                submitBtn.disabled = true;
                loading.style.display = 'block';
                
                // Ïã§Ï†ú API Ìò∏Ï∂ú ÏãúÎÆ¨Î†àÏù¥ÏÖò
                await new Promise(resolve => setTimeout(resolve, 2000));
                
                alert('Í≥ºÏ†úÍ∞Ä ÏÑ±Í≥µÏ†ÅÏúºÎ°ú Ï†úÏ∂úÎêòÏóàÏäµÎãàÎã§!');
                
                // ÏÉÅÌÉú ÏóÖÎç∞Ïù¥Ìä∏
                const statusElement = document.getElementById('assignment-status');
                statusElement.textContent = 'Ï†úÏ∂ú ÏôÑÎ£å';
                statusElement.className = 'assignment-status status-submitted';
                
                submitBtn.textContent = 'Ï†úÏ∂ú ÏôÑÎ£å';
                
                // Ï†úÏ∂ú ÎÇ¥Ïó≠ Ï∂îÍ∞Ä
                addSubmissionToHistory();
                
            } catch (error) {
                console.error('Ï†úÏ∂ú Ïò§Î•ò:', error);
                alert('Ï†úÏ∂ú Ï§ë Ïò§Î•òÍ∞Ä Î∞úÏÉùÌñàÏäµÎãàÎã§.');
                submitBtn.disabled = false;
            } finally {
                loading.style.display = 'none';
            }
        }
        
        // ÏûÑÏãú Ï†ÄÏû•
        function saveDraft() {
            alert('ÏûÑÏãú Ï†ÄÏû•ÎêòÏóàÏäµÎãàÎã§.');
        }
        
        // Ï†úÏ∂ú ÎÇ¥Ïö© Ï¥àÍ∏∞Ìôî
        function clearSubmission() {
            if (confirm('Î™®Îì† ÎÇ¥Ïö©ÏùÑ Ï¥àÍ∏∞ÌôîÌïòÏãúÍ≤†ÏäµÎãàÍπå?')) {
                selectedFiles = [];
                updateFileList();
                document.getElementById('submission-text').value = '';
            }
        }
        
        // Ï†úÏ∂ú ÎÇ¥Ïó≠ Î°úÎìú
        function loadSubmissionHistory(assignment) {
            const historyContainer = document.getElementById('submission-history');
            
            if (assignment.status === 'pending') {
                historyContainer.innerHTML = '<p style="text-align: center; color: #718096;">ÏïÑÏßÅ Ï†úÏ∂ú ÎÇ¥Ïó≠Ïù¥ ÏóÜÏäµÎãàÎã§.</p>';
                return;
            }
            
            const submissions = [
                {
                    id: 1,
                    submittedAt: '2025-05-25 14:30:00',
                    files: ['functions.js', 'scope-example.html'],
                    status: assignment.status,
                    score: assignment.score,
                    feedback: assignment.feedback
                }
            ];
            
            historyContainer.innerHTML = submissions.map(submission => `
                <div class="submission-item">
                    <div class="submission-header">
                        <strong>Ï†úÏ∂ú #${submission.id}</strong>
                        <span class="status-${submission.status}">${getStatusText(submission.status)}</span>
                    </div>
                    <div class="submission-meta">
                        Ï†úÏ∂úÏùº: ${submission.submittedAt}<br>
                        ÌååÏùº: ${submission.files.join(', ')}
                        ${submission.score !== null ? `<br>Ï†êÏàò: ${submission.score}Ï†ê` : ''}
                    </div>
                    ${submission.feedback ? `
                        <div style="margin-top: 0.5rem; padding: 0.5rem; background: #f7fafc; border-radius: 4px;">
                            <strong>ÌîºÎìúÎ∞±:</strong> ${submission.feedback}
                        </div>
                    ` : ''}
                </div>
            `).join('');
        }
        
        // Ï†úÏ∂ú ÎÇ¥Ïó≠Ïóê ÏÉà Ï†úÏ∂ú Ï∂îÍ∞Ä
        function addSubmissionToHistory() {
            const historyContainer = document.getElementById('submission-history');
            const now = new Date().toLocaleString('ko-KR');
            const fileNames = selectedFiles.map(f => f.name);
            
            const newSubmission = `
                <div class="submission-item">
                    <div class="submission-header">
                        <strong>Ï†úÏ∂ú #2</strong>
                        <span class="status-submitted">Ï†úÏ∂ú ÏôÑÎ£å</span>
                    </div>
                    <div class="submission-meta">
                        Ï†úÏ∂úÏùº: ${now}<br>
                        ÌååÏùº: ${fileNames.join(', ') || 'ÌÖçÏä§Ìä∏ Ï†úÏ∂ú'}
                    </div>
                </div>
            `;
            
            historyContainer.innerHTML = newSubmission + historyContainer.innerHTML;
        }
        
        // Ïú†Ìã∏Î¶¨Ìã∞ Ìï®ÏàòÎì§
        function getTypeText(type) {
            const types = {
                'file': 'ÌååÏùº Ï†úÏ∂ú',
                'text': 'ÌÖçÏä§Ìä∏ Ï†úÏ∂ú',
                'quiz': 'ÌÄ¥Ï¶à',
                'project': 'ÌîÑÎ°úÏ†ùÌä∏'
            };
            return types[type] || type;
        }
        
        function getStatusText(status) {
            const statuses = {
                'pending': 'ÎØ∏Ï†úÏ∂ú',
                'submitted': 'Ï†úÏ∂ú ÏôÑÎ£å',
                'graded': 'Ï±ÑÏ†ê ÏôÑÎ£å',
                'completed': 'ÏôÑÎ£å'
            };
            return statuses[status] || status;
        }
        
        // Î°úÍ∑∏ÏïÑÏõÉ
        function logout() {
            if (confirm('Î°úÍ∑∏ÏïÑÏõÉ ÌïòÏãúÍ≤†ÏäµÎãàÍπå?')) {
                localStorage.removeItem('authToken');
                localStorage.removeItem('userInfo');
                window.location.href = '/';
            }
        }
    </script>
</body>
</html>