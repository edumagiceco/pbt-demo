<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI ì¸ì¬ ì»¤ë¦¬ì–´ í”Œë«í¼ PBT</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            line-height: 1.6;
        }
        
        .navbar {
            background: rgba(255, 255, 255, 0.95);
            padding: 1rem 2rem;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
            backdrop-filter: blur(10px);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .navbar .logo {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            font-size: 1.2rem;
            font-weight: 700;
            color: #4a5568;
        }
        
        .navbar .logo img {
            height: 40px;
            width: auto;
        }
        
        .navbar .user-info {
            display: flex;
            align-items: center;
            gap: 1rem;
        }
        
        .navbar .user-name {
            color: #4a5568;
            font-weight: 500;
        }
        
        .navbar .logout-btn {
            padding: 0.5rem 1rem;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 500;
            transition: all 0.3s ease;
        }
        
        .navbar .logout-btn:hover {
            transform: translateY(-1px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.3);
        }
        
        .container {
            max-width: 1200px;
            margin: 2rem auto;
            padding: 0 2rem;
        }
        
        .welcome-section {
            background: rgba(255, 255, 255, 0.95);
            padding: 2rem;
            border-radius: 15px;
            margin-bottom: 2rem;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.15);
            text-align: center;
        }
        
        .welcome-section h2 {
            color: #4a5568;
            font-size: 2rem;
            margin-bottom: 1rem;
        }
        
        .welcome-section p {
            color: #718096;
            font-size: 1.1rem;
        }
        
        .dashboard-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 2rem;
            margin-bottom: 2rem;
        }
        
        .dashboard-card {
            background: rgba(255, 255, 255, 0.95);
            padding: 2rem;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.15);
            transition: transform 0.3s ease;
        }
        
        .dashboard-card:hover {
            transform: translateY(-5px);
        }
        
        .dashboard-card h3 {
            color: #4a5568;
            font-size: 1.3rem;
            margin-bottom: 1rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        
        .dashboard-card p {
            color: #718096;
            margin-bottom: 1rem;
        }
        
        .dashboard-card .btn {
            display: inline-block;
            padding: 0.7rem 1.5rem;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            text-decoration: none;
            border-radius: 8px;
            font-weight: 500;
            transition: all 0.3s ease;
        }
        
        .dashboard-card .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.3);
        }
        
        .quick-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
            margin-bottom: 2rem;
        }
        
        .stat-card {
            background: rgba(255, 255, 255, 0.95);
            padding: 1.5rem;
            border-radius: 12px;
            text-align: center;
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.1);
        }
        
        .stat-card .stat-number {
            font-size: 2rem;
            font-weight: 700;
            color: #667eea;
            margin-bottom: 0.5rem;
        }
        
        .stat-card .stat-label {
            color: #718096;
            font-size: 0.9rem;
        }
        
        @media (max-width: 768px) {
            .navbar {
                padding: 1rem;
                flex-direction: column;
                gap: 1rem;
            }
            
            .container {
                padding: 0 1rem;
            }
            
            .dashboard-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <nav class="navbar">
        <div class="logo">
            <img src="/assets/images/pbt-logo.png" alt="PBT Logo">
            <span>AI ì¸ì¬ ì»¤ë¦¬ì–´ í”Œë«í¼ PBT</span>
        </div>
        <div class="user-info">
            <span class="user-name" id="userName">ì‚¬ìš©ìë‹˜</span>
            <button class="logout-btn" onclick="logout()">ë¡œê·¸ì•„ì›ƒ</button>
        </div>
    </nav>
    
    <div class="container">
        <div class="welcome-section">
            <h2>ì•ˆë…•í•˜ì„¸ìš”, <span id="welcomeName">ì‚¬ìš©ì</span>ë‹˜! ğŸ‘‹</h2>
            <p>PBT LMSì— ì˜¤ì‹  ê²ƒì„ í™˜ì˜í•©ë‹ˆë‹¤. ì˜¤ëŠ˜ë„ ë¬¸ì œ í•´ê²° ëŠ¥ë ¥ì„ ê¸°ë¥´ë©° í•™ìŠµí•´ë³´ì„¸ìš”.</p>
        </div>
        
        <div class="quick-stats">
            <div class="stat-card">
                <div class="stat-number" id="courseCount">-</div>
                <div class="stat-label">ì°¸ì—¬ ì¤‘ì¸ ê³¼ì •</div>
            </div>
            <div class="stat-card">
                <div class="stat-number" id="problemCount">-</div>
                <div class="stat-label">í•´ê²°í•œ ë¬¸ì œ</div>
            </div>
            <div class="stat-card">
                <div class="stat-number" id="progressPercent">-</div>
                <div class="stat-label">ì „ì²´ ì§„ë„ìœ¨</div>
            </div>
        </div>
        
        <div class="dashboard-grid">
            <div class="dashboard-card">
                <h3>ğŸ“š ë‚´ ê³¼ì •</h3>
                <p>ì°¸ì—¬ ì¤‘ì¸ ê³¼ì •ë“¤ì„ í™•ì¸í•˜ê³  í•™ìŠµì„ ê³„ì†í•˜ì„¸ìš”.</p>
                <a href="/courses.html" class="btn">ê³¼ì • ë³´ê¸°</a>
            </div>
            
            <div class="dashboard-card">
                <h3>ğŸ§© ë¬¸ì œ í’€ì´</h3>
                <p>ë‹¤ì–‘í•œ ë¬¸ì œë“¤ì„ í’€ì–´ë³´ë©° ì‹¤ë¬´ ì—­ëŸ‰ì„ í‚¤ì›Œë³´ì„¸ìš”.</p>
                <a href="/problems.html" class="btn">ë¬¸ì œ í’€ê¸°</a>
            </div>
            
            <div class="dashboard-card">
                <h3>ğŸ“Š í•™ìŠµ ì§„ë„</h3>
                <p>ë‚´ í•™ìŠµ í˜„í™©ê³¼ ì§„ë„ë¥¼ ìƒì„¸íˆ í™•ì¸í•˜ì„¸ìš”.</p>
                <a href="/progress.html" class="btn">ì§„ë„ í™•ì¸</a>
            </div>
            
            <div class="dashboard-card">
                <h3>ğŸ’¬ í† ë¡  ê²Œì‹œíŒ</h3>
                <p>ë‹¤ë¥¸ í•™ìŠµìë“¤ê³¼ ì˜ê²¬ì„ ë‚˜ëˆ„ê³  í† ë¡ í•˜ì„¸ìš”.</p>
                <a href="/discussions.html" class="btn">í† ë¡  ì°¸ì—¬</a>
            </div>
            
            <div class="dashboard-card">
                <h3>ğŸ“ ê³¼ì œ ì œì¶œ</h3>
                <p>ê³¼ì œë¥¼ ì œì¶œí•˜ê³  í”¼ë“œë°±ì„ ë°›ì•„ë³´ì„¸ìš”.</p>
                <a href="/assignments.html" class="btn">ê³¼ì œ ë³´ê¸°</a>
            </div>
            
            <div class="dashboard-card">
                <h3>ğŸ¯ ë§Œë‹¤ë¼íŠ¸</h3>
                <p>ëª©í‘œë¥¼ ì²´ê³„ì ìœ¼ë¡œ ê´€ë¦¬í•˜ê³  ë‹¬ì„±í•´ë³´ì„¸ìš”.</p>
                <a href="/mandarts.html" class="btn">ë§Œë‹¤ë¼íŠ¸ ë³´ê¸°</a>
            </div>
            
            <div class="dashboard-card">
                <h3>ğŸ§‘â€ğŸ« ê°•ì‚¬ AI</h3>
                <p>ê°•ì˜ ìë£Œë¥¼ ê¸°ë°˜ìœ¼ë¡œ ê°œë…ì„ ì„¤ëª…í•˜ê³  í•™ìŠµì„ ë„ì™€ë“œë¦½ë‹ˆë‹¤.</p>
                <a href="/instructor-ai.html" class="btn">ê°•ì‚¬ AI ì‹œì‘</a>
            </div>
            
            <div class="dashboard-card">
                <h3>ğŸ¤– AI ë©˜í† </h3>
                <p>ë‚˜ë§Œì˜ AI ë©˜í† ë¥¼ ë§Œë“¤ì–´ 1:1 ë§ì¶¤í˜• í•™ìŠµì„ ë°›ì•„ë³´ì„¸ìš”.</p>
                <a href="/mentors.html" class="btn">ë©˜í†  ê´€ë¦¬</a>
            </div>
            

            
            <div class="dashboard-card">
                <h3>ğŸ‘¤ í”„ë¡œí•„ ì„¤ì •</h3>
                <p>ë‚´ í”„ë¡œí•„ê³¼ ê³„ì • ì„¤ì •ì„ ê´€ë¦¬í•˜ì„¸ìš”.</p>
                <a href="/profile.html" class="btn">ì„¤ì • ë³€ê²½</a>
            </div>
            
            <div id="adminCard" class="dashboard-card" style="display: none; background: linear-gradient(135deg, #e53e3e 0%, #c53030 100%); color: white;">
                <h3>ğŸ›¡ï¸ ê´€ë¦¬ì ëŒ€ì‹œë³´ë“œ</h3>
                <p>ì‹œìŠ¤í…œ ê´€ë¦¬ ë° ì‚¬ìš©ì ê´€ë¦¬ ê¸°ëŠ¥ì— ì ‘ê·¼í•˜ì„¸ìš”.</p>
                <a href="/admin-dashboard.html" class="btn" style="background: rgba(255, 255, 255, 0.2); color: white; border: 2px solid white;">ê´€ë¦¬ì ëª¨ë“œ</a>
            </div>
        </div>
    </div>

    <script>
        // í˜ì´ì§€ ë¡œë“œ ì‹œ ì‚¬ìš©ì ì •ë³´ í™•ì¸
        document.addEventListener('DOMContentLoaded', async () => {
            const token = localStorage.getItem('authToken');
            const userInfo = localStorage.getItem('userInfo');
            
            if (!token) {
                alert('ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤.');
                window.location.href = '/login.html';
                return;
            }
            
            try {
                // í† í° ìœ íš¨ì„± ê²€ì‚¬
                const response = await fetch('/api/auth/me', {
                    headers: {
                        'Authorization': `Bearer ${token}`
                    }
                });
                
                if (!response.ok) {
                    throw new Error('í† í°ì´ ìœ íš¨í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.');
                }
                
                const result = await response.json();
                
                if (result.success && result.user) {
                    // ì‚¬ìš©ì ì •ë³´ í‘œì‹œ
                    const user = result.user;
                    document.getElementById('userName').textContent = user.fullName || user.username;
                    document.getElementById('welcomeName').textContent = user.fullName || user.username;
                    
                    // ê´€ë¦¬ì ì¹´ë“œ í‘œì‹œ (ê´€ë¦¬ìì¸ ê²½ìš°ì—ë§Œ)
                    if (user.userType === 'admin') {
                        document.getElementById('adminCard').style.display = 'block';
                    }
                    
                    // ì‚¬ìš©ì ì •ë³´ ì—…ë°ì´íŠ¸
                    localStorage.setItem('userInfo', JSON.stringify(user));
                    
                    // í†µê³„ ì •ë³´ ë¡œë“œ
                    loadUserStats(user.id);
                } else {
                    throw new Error('ì‚¬ìš©ì ì •ë³´ë¥¼ ê°€ì ¸ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
                }
                
            } catch (error) {
                console.error('ì¸ì¦ ì˜¤ë¥˜:', error);
                
                // ë°ëª¨ í™˜ê²½ì„ ìœ„í•œ fallback: localStorageì—ì„œ ì‚¬ìš©ì ì •ë³´ í™•ì¸
                const savedUserInfo = localStorage.getItem('userInfo');
                if (savedUserInfo) {
                    try {
                        const user = JSON.parse(savedUserInfo);
                        document.getElementById('userName').textContent = user.fullName || user.username || 'ì‚¬ìš©ì';
                        document.getElementById('welcomeName').textContent = user.fullName || user.username || 'ì‚¬ìš©ì';
                        
                        // ê´€ë¦¬ì ì¹´ë“œ í‘œì‹œ (ê´€ë¦¬ìì¸ ê²½ìš°ì—ë§Œ)
                        if (user.userType === 'admin') {
                            document.getElementById('adminCard').style.display = 'block';
                        }
                        
                        // ì‚¬ìš©ì ìœ í˜•ë³„ ë°ëª¨ í†µê³„ ë°ì´í„° í‘œì‹œ
                        if (user.userType === 'student') {
                            document.getElementById('courseCount').textContent = '4';
                            document.getElementById('problemCount').textContent = '27';
                            document.getElementById('progressPercent').textContent = '62%';
                        } else if (user.userType === 'instructor') {
                            document.getElementById('courseCount').textContent = '2';
                            document.getElementById('problemCount').textContent = '8';
                            document.getElementById('progressPercent').textContent = '100%';
                        } else if (user.userType === 'admin') {
                            document.getElementById('courseCount').textContent = '8';
                            document.getElementById('problemCount').textContent = '0';
                            document.getElementById('progressPercent').textContent = '100%';
                        } else {
                            document.getElementById('courseCount').textContent = '3';
                            document.getElementById('problemCount').textContent = '15';
                            document.getElementById('progressPercent').textContent = '68%';
                        }
                        
                        return; // ì„±ê³µì ìœ¼ë¡œ fallback ì²˜ë¦¬ë¨
                    } catch (parseError) {
                        console.error('ì‚¬ìš©ì ì •ë³´ íŒŒì‹± ì˜¤ë¥˜:', parseError);
                    }
                }
                
                // ì™„ì „ ì‹¤íŒ¨ ì‹œ ë¡œê·¸ì¸ í˜ì´ì§€ë¡œ ì´ë™
                localStorage.removeItem('authToken');
                localStorage.removeItem('userInfo');
                alert('ì„¸ì…˜ì´ ë§Œë£Œë˜ì—ˆìŠµë‹ˆë‹¤. ë‹¤ì‹œ ë¡œê·¸ì¸í•´ì£¼ì„¸ìš”.');
                window.location.href = '/login.html';
            }
        });
        
        // ì‚¬ìš©ì í†µê³„ ì •ë³´ ë¡œë“œ
        async function loadUserStats(userId) {
            try {
                const token = localStorage.getItem('authToken');
                
                // ê°ê°ì˜ í†µê³„ë¥¼ ë³‘ë ¬ë¡œ ë¡œë“œ
                const [coursesRes, problemsRes, progressRes] = await Promise.all([
                    fetch(`/api/users/${userId}/courses`, {
                        headers: { 'Authorization': `Bearer ${token}` }
                    }),
                    fetch(`/api/users/${userId}/problems/solved`, {
                        headers: { 'Authorization': `Bearer ${token}` }
                    }),
                    fetch(`/api/users/${userId}/progress`, {
                        headers: { 'Authorization': `Bearer ${token}` }
                    })
                ]);
                
                // ê¸°ë³¸ê°’ ì„¤ì •
                let courseCount = 0;
                let problemCount = 0;
                let progressPercent = 0;
                
                if (coursesRes.ok) {
                    const coursesData = await coursesRes.json();
                    courseCount = coursesData.data ? coursesData.data.length : 0;
                }
                
                if (problemsRes.ok) {
                    const problemsData = await problemsRes.json();
                    problemCount = problemsData.count || 0;
                }
                
                if (progressRes.ok) {
                    const progressData = await progressRes.json();
                    progressPercent = Math.round(progressData.averageProgress || 0);
                }
                
                // UI ì—…ë°ì´íŠ¸
                document.getElementById('courseCount').textContent = courseCount;
                document.getElementById('problemCount').textContent = problemCount;
                document.getElementById('progressPercent').textContent = `${progressPercent}%`;
                
            } catch (error) {
                console.error('í†µê³„ ë¡œë“œ ì˜¤ë¥˜:', error);
                // ì˜¤ë¥˜ ë°œìƒ ì‹œ ê¸°ë³¸ê°’ ìœ ì§€
                document.getElementById('courseCount').textContent = '0';
                document.getElementById('problemCount').textContent = '0';
                document.getElementById('progressPercent').textContent = '0%';
            }
        }
        
        // ë¡œê·¸ì•„ì›ƒ í•¨ìˆ˜
        function logout() {
            if (confirm('ë¡œê·¸ì•„ì›ƒ í•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
                localStorage.removeItem('authToken');
                localStorage.removeItem('userInfo');
                window.location.href = '/';
            }
        }
    </script>
    
    <!-- PBT LMS ì±—ë´‡ -->
    <script src="/js/chatbot.js"></script>
</body>
</html>